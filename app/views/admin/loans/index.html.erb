<%content_for :css do%>

    <style>
      .form-group{
        overflow: auto;
        margin-bottom: 10px;
      }
      .form-group .form-control{
        float: left;
        width: auto;
      }
      .form-group .form-control-label{
        float: left;
        line-height: 39px;
        margin-bottom: 0;
        padding: 0 10px;
        width: auto;
      }
    </style>
<%end%>

<nav class="breadcrumb sl-breadcrumb">
  <!--a class="breadcrumb-item" href="index.html">Starlight</a>
  <a class="breadcrumb-item" href="index.html">Pages</a-->
  <span class="breadcrumb-item active">订单管理</span>
</nav>

<div class="sl-pagebody">
  <div class="sl-page-title">
    <div class="card pd-20 pd-sm-40">

      <h6 class="card-body-title">订单管理</h6>
      <form action="<%=admin_loans_path%>" method="get" class="stdform">
        <div class="form-layout pd-b-10 pd-t-10">
          <div class="row" style="margin: 0">
            <div class="form-group">
              <label class="form-control-label">姓名: </label>
              <input class="form-control" type="text" name="name" value="<%=params[:name]%>">
            </div>
            <div class="form-group">
              <label class="form-control-label">初审状态: </label>
              <select name="first" class="form-control select2">
                <option value="">全部</option>
                <option value="verifyfail" <%=params[:first]=='verifyfail' ? 'selected' : ''%>>审核失败或未提交</option>
                <option value="verifypass" <%=params[:first]=='verifypass' ? 'selected' : ''%>>审核成功</option>
                <option value="unverified" <%=params[:first]=='unverified' ? 'selected' : ''%>>审核中</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-control-label">复审状态: </label>
              <select name="review" class="form-control select2" >
                <option value="">全部</option>
                <option value="verifyfail" <%=params[:review]=='verifyfail' ? 'selected' : ''%>>审核失败或未提交</option>
                <option value="verifypass" <%=params[:review]=='verifypass' ? 'selected' : ''%>>审核成功</option>
                <option value="unverified" <%=params[:review]=='unverified' ? 'selected' : ''%>>审核中</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-control-label">开始日期: </label>
              <input class="form-control fc-datepicker" type="text" name="starttime" value="<%=(params[:starttime]||'2017-01-01')%>">
            </div>
            <div class="form-group">
              <label class="form-control-label">结束日期: </label>
              <input class="form-control fc-datepicker" type="text" name="endtime" value="<%=(params[:endtime]||Time.now.strftime('%Y-%m-%d'))%>" >
            </div>
            <div class="form-layout-footer" style="padding-left: 10px">
              <button class="btn btn-info mg-r-5" style="line-height: 1">查询</button>
              <a class="btn btn-secondary" style="line-height: 1" href="<%=new_admin_loan_url%>">新建</a>
              <button name="export" value="export" class="btn btn-secondary mg-r-5" style="line-height: 1;" >导出文件</button>
            </div><!-- form-layout-footer -->
          </div><!-- row -->
        </div><!-- form-layout -->
      </form>
      <div style="overflow: auto;width: 100%;">
      <table class="table table-hover table-bordered mg-b-0" >
        <thead class="bg-info">
        <tr>
          <% if current_user.login=='admin' %>
              <th>操作</th>
              <th>财务审核</th>
          <% end %>
          <th>订单录入时间</th>
          <th>初审状态</th>
          <th>复审状态</th>
          <th>借款人姓名</th>
          <th>贷款利率</th>
          <th>结息日</th>
        </tr>
        </thead>
        <tbody>
        <%@loans.each do |ele|%>
            <tr>
              <% if current_user.login=='admin' %>
                  <% if ele.first_verify==Loan::VERIFYPASS && ele.review_verify==Loan::VERIFYPASS && ele.pay_verify==Loan::VERIFYFAIL %>
                      <td>
                        <%= link_to '提交打款审核', financial_verify_admin_loans_path(ele), data: {confirm: '确定提交打款审核?'} %> &nbsp;
                      </td>
                  <% else %>
                      <td></td>
                  <% end %>
                  <td><%=ele.get_status(ele.pay_verify,false)%></td>
              <% end %>
              <td><%= ele.created_at.strftime('%Y-%m-%d %H:%M:%S') %></td>
              <td><%=ele.get_status(ele.first_verify,ele.first_submit)%></td>
              <td><%=ele.get_status(ele.review_verify,ele.review_submit)%></td>
              <td><a href="<%=admin_loan_path(ele)%>"><%=ele.name%></a></td>
              <td><%=ele.get_lx%></td>
              <td><%=(ele.instalments[0].present? ? (ele.instalments[0].overdue_time-1.days).strftime("%d") : '')%></td>
            </tr>
        <%end%>
        </tbody>
      </table>
      </div>
      <div class="dataTables_wrapper no-footer">
        <%= paginate @loans %>
      </div>
    </div>
  </div><!-- sl-page-title -->

</div><!-- sl-pagebody -->

<%content_for :js do%>
    <script>

        $('.fc-datepicker').datepicker({
            showOtherMonths: true,
            selectOtherMonths: true,
            dateFormat:'yy-mm-dd'
        });

    </script>
<%end%>