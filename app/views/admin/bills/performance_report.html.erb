<%content_for :css do%>
  <link href="/css/spinkit.css" rel="stylesheet">

    <style>
      .form-group{
        overflow: auto;
        margin-bottom: 10px;
      }
      .form-group .form-control{
        float: left;
        width: auto;
      }
      .form-group .form-control-label{
        float: left;
        line-height: 39px;
        margin-bottom: 0;
        padding: 0 10px;
        width: auto;
      }
        .card-body-title{
          color: #8b8b8b;
        }
    </style>
<%end%>

<nav class="breadcrumb sl-breadcrumb">
  <!--a class="breadcrumb-item" href="index.html">Starlight</a>
  <a class="breadcrumb-item" href="index.html">Pages</a-->
  <span class="breadcrumb-item active">业绩</span>
</nav>


<div class="sl-pagebody" id="data">
  <div class="sl-page-title">
    <div class="card pd-20 pd-sm-20">


        <div class="form-layout pd-b-10 pd-t-10">
          <div class="row" style="margin: 0">
            <div class="form-group">
              <label class="form-control-label">营业部: </label>
              <select class="form-control select2" data-placeholder="Choose country" style="width: 100px" id="search_yyb">
                <option value="zjwz" >浙江温州</option>
                <option value="zjsxsz">绍兴嵊州</option>
                <option value="zjsxkq">绍兴柯桥</option>
                <option value="zjsxyc">绍兴越城</option>
                <option value="zjhz">浙江杭州</option>
                <option value="ahhf">安徽合肥</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-control-label">产品类型: </label>
              <select class="form-control select2" data-placeholder="Choose country" style="width: 100px" id="search_cplx">
                <option value="全款车" >全款车</option>
                <option value="按揭车">按揭车</option>
                <option value="房贷">房贷</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-control-label">开始日期: </label>
              <input class="form-control fc-datepicker" type="text" id="search_starttime" value="<%=Time.now.beginning_of_month.strftime('%Y-%m-%d')%>">
            </div>
            <div class="form-group">
              <label class="form-control-label">结束日期: </label>
              <input class="form-control fc-datepicker" type="text" id="search_endtime" value="<%=Time.now.strftime('%Y-%m-%d')%>" >
            </div>
            <div class="form-layout-footer" style="padding-left: 10px">
              <button class="btn btn-info mg-r-5" style="line-height: 1" onclick="search_data()">查询</button>
            </div><!-- form-layout-footer -->
          </div><!-- row -->

        </div><!-- form-layout -->
    </div>
  </div><!-- sl-page-title -->

  <div class="row row-sm">
    <div class="col-4">
      <div class="card pd-20 pd-sm-25 bg-info">
        <div class="d-flex align-items-center">
          <span class="sparkline2">3,4,8,7,4,3,1,2,1</span>
          <div class="mg-l-15">
            <p class="tx-uppercase tx-11 tx-spacing-1 tx-medium tx-white-5 mg-b-8">交易量(元)</p>
            <h3 class="tx-bold tx-lato tx-white mg-b-0"  id="data-jyl">0</h3>
          </div>
        </div>
      </div><!-- card -->
    </div><!-- col-3 -->
    <div class="col-4 mg-xl-t-0">
      <div class="card pd-20 pd-sm-25 bg-info">
        <div class="d-flex align-items-center">
          <span class="sparkline2">3,4,8,7,4,3,1,2,1</span>
          <div class="mg-l-15">
            <p class="tx-uppercase tx-11 tx-spacing-1 tx-medium tx-white-5 mg-b-8">贷款余额</p>
            <h3 class="tx-bold tx-lato tx-white mg-b-0" id="data-dkye">0</h3>
          </div>
        </div>
      </div><!-- card -->
    </div><!-- col-3 -->
    <div class="col-4 mg-xl-t-0">
      <div class="card pd-20 pd-sm-25 bg-info">
        <div class="d-flex align-items-center">
          <span class="sparkline2">3,4,8,7,4,3,1,2,1</span>
          <div class="mg-l-15">
            <p class="tx-uppercase tx-11 tx-spacing-1 tx-medium tx-white-5 mg-b-8">平均借款额度</p>
            <h3 class="tx-bold tx-lato tx-white mg-b-0"  id="data-pjjked">0</h3>
          </div>
        </div>
      </div><!-- card -->
    </div><!-- col-3 -->
  </div><!-- row -->
  <div class="row row-sm mg-t-20">
    <div class="col-3">
      <div class="card pd-20 pd-sm-25">
        <div class="d-flex align-items-center justify-content-between mg-b-10">
          <h6 class="card-body-title tx-12 tx-spacing-1">贷款笔数</h6>
        </div><!-- d-flex -->
        <h2 class="tx-teal tx-lato tx-center mg-b-15" id="data-dkbs">0</h2>
      </div><!-- card -->
    </div><!-- col-3 -->
    <div class="col-3">
      <div class="card pd-20 pd-sm-25">
        <div class="d-flex align-items-center justify-content-between mg-b-10">
          <h6 class="card-body-title tx-12 tx-spacing-1">交易笔数</h6>
        </div><!-- d-flex -->
        <h2 class="tx-teal tx-lato tx-center mg-b-15" id="data-jybs">0</h2>
      </div><!-- card -->
    </div><!-- col-3 -->
    <div class="col-3">
      <div class="card pd-20 pd-sm-25">
        <div class="d-flex align-items-center justify-content-between mg-b-10">
          <h6 class="card-body-title tx-12 tx-spacing-1">贷款人数</h6>
        </div><!-- d-flex -->
        <h2 class="tx-teal tx-lato tx-center mg-b-15" id="data-dkrs">0</h2>
      </div><!-- card -->
    </div><!-- col-3 -->
    <div class="col-3">
      <div class="card pd-20 pd-sm-25">
        <div class="d-flex align-items-center justify-content-between mg-b-10">
          <h6 class="card-body-title tx-12 tx-spacing-1">平均借款周期(月)</h6>
        </div><!-- d-flex -->
        <h2 class="tx-teal tx-lato tx-center mg-b-15" id="data-pjjkzq">0</h2>
      </div><!-- card -->
    </div><!-- col-3 -->
  </div>
  <div class="row row-sm mg-t-20">
    <div class="col-4">
      <div class="card pd-20 pd-sm-25">
        <div class="d-flex justify-content-between align-items-center mg-b-15">
          <h6 class="card-body-title tx-12 mg-b-5">抵押</h6>
        </div>
        <div class="bg-primary-light">
          <div id="rickshaw1" class="wd-100p ht-100 rickshaw_graph"><svg width="308" height="100"><path class="path" d="M0,60Q20.533333333333335,50.86666666666667,23.692307692307693,51C28.43076923076923,51.2,42.64615384615385,80.1,47.38461538461539,62S66.33846153846154,69.4,71.07692307692308,70S90.03076923076924,69,94.76923076923077,68S113.72307692307693,58.8,118.46153846153847,60S137.41538461538462,77,142.15384615384616,80S161.1076923076923,90,165.84615384615384,90S184.8,70.5,189.53846153846155,80S208.4923076923077,76.5,213.23076923076923,75S232.1846153846154,64.5,236.92307692307693,65S255.87692307692305,80.5,260.6153846153846,80S279.5692307692308,60.5,284.3076923076923,60Q287.4666666666667,59.666666666666664,308,75" fill="none" stroke="#0866C6" stroke-width="2" opacity="1"></path><path class="stroke"></path></svg></div>
        </div>
        <div class="row no-gutters mg-t-1">
          <div class="col tx-center bg-gray-200 pd-y-20">
            <h5 class="tx-lato tx-inverse tx-bold mg-b-5" id="data-dyje">0</h5>
            <p class="tx-11 tx-spacing-1 mg-b-0 tx-uppercase">金额</p>
          </div><!-- col -->
          <div class="col tx-center bg-gray-200 pd-y-20 mg-l-1">
            <h5 class="tx-lato tx-inverse tx-bold mg-b-5" id="data-dybs">0</h5>
            <p class="tx-11 tx-spacing-1 mg-b-0 tx-uppercase">笔数</p>
          </div><!-- col -->
        </div><!-- row -->
      </div><!-- card -->
    </div><!-- col-4 -->
    <div class="col-4 mg-t-20 mg-md-t-0">
      <div class="card pd-20 pd-sm-25">
        <div class="d-flex justify-content-between align-items-center mg-b-15">
          <h6 class="card-body-title tx-12 mg-b-5">质押</h6>
        </div>
        <div class="bg-success-light">
          <div id="rickshaw2" class="wd-100p ht-100 rickshaw_graph"><svg width="308" height="100"><path class="path" d="M0,60Q20.533333333333335,50.86666666666667,23.692307692307693,51C28.43076923076923,51.2,42.64615384615385,60.1,47.38461538461539,62S66.33846153846154,30.4,71.07692307692308,70S90.03076923076924,69,94.76923076923077,68S113.72307692307693,58.8,118.46153846153847,60S137.41538461538462,77,142.15384615384616,80S161.1076923076923,90,165.84615384615384,90S184.8,81.5,189.53846153846155,80S208.4923076923077,76.5,213.23076923076923,75S232.1846153846154,64.5,236.92307692307693,65S255.87692307692305,80.5,260.6153846153846,80S279.5692307692308,60.5,284.3076923076923,60Q287.4666666666667,59.666666666666664,308,75" fill="none" stroke="#23BF08" stroke-width="2" opacity="1"></path><path class="stroke"></path></svg></div>
        </div>
        <div class="row no-gutters mg-t-1">
          <div class="col tx-center bg-gray-200 pd-y-20">
            <h5 class="tx-lato tx-inverse tx-bold mg-b-5"  id="data-zyje">0</h5>
            <p class="tx-11 tx-spacing-1 mg-b-0 tx-uppercase">金额</p>
          </div><!-- col -->
          <div class="col tx-center bg-gray-200 pd-y-20 mg-l-1">
            <h5 class="tx-lato tx-inverse tx-bold mg-b-5"  id="data-zybs">0</h5>
            <p class="tx-11 tx-spacing-1 mg-b-0 tx-uppercase">笔数</p>
          </div><!-- col -->
        </div><!-- row -->
      </div><!-- card -->
    </div><!-- col-4 -->
    <div class="col-4">
      <div class="card pd-20 pd-sm-25">
        <div class="d-flex justify-content-between align-items-center mg-b-15">
          <h6 class="card-body-title tx-12 mg-b-5">新增</h6>
        </div>
        <div class="bg-primary-light" style="background-color: rgba(255,192,86,0.35)">
          <div id="rickshaw1" class="wd-100p ht-100 rickshaw_graph"><svg width="308" height="100"><path class="path" d="M0,60Q20.533333333333335,50.86666666666667,23.692307692307693,51C28.43076923076923,51.2,42.64615384615385,60.1,47.38461538461539,62S66.33846153846154,69.4,71.07692307692308,70S90.03076923076924,69,94.76923076923077,68S113.72307692307693,100.8,118.46153846153847,60S137.41538461538462,77,142.15384615384616,80S161.1076923076923,90,165.84615384615384,90S184.8,81.5,189.53846153846155,80S208.4923076923077,76.5,213.23076923076923,75S232.1846153846154,64.5,236.92307692307693,65S255.87692307692305,80.5,260.6153846153846,80S279.5692307692308,60.5,284.3076923076923,60Q287.4666666666667,59.666666666666664,308,75" fill="none" stroke="#ffbd54" stroke-width="2" opacity="1"></path><path class="stroke"></path></svg></div>
        </div>
        <div class="row no-gutters mg-t-1">
          <div class="col tx-center bg-gray-200 pd-y-20">
            <h5 class="tx-lato tx-inverse tx-bold mg-b-5"  id="data-xzje">0</h5>
            <p class="tx-11 tx-spacing-1 mg-b-0 tx-uppercase">金额</p>
          </div><!-- col -->
          <div class="col tx-center bg-gray-200 pd-y-20 mg-l-1">
            <h5 class="tx-lato tx-inverse tx-bold mg-b-5"  id="data-xzbs">0</h5>
            <p class="tx-11 tx-spacing-1 mg-b-0 tx-uppercase">笔数</p>
          </div><!-- col -->
        </div><!-- row -->
      </div><!-- card -->
    </div><!-- col-4 -->
  </div>
</div><!-- sl-pagebody -->

<div class="sl-pagebody" id="loading" style="display:none">
  <div class="d-flex bg-gray-200 ht-300 pos-relative align-items-center">
    <div class="sk-three-bounce">
      <div class="sk-child sk-bounce1 bg-gray-800"></div>
      <div class="sk-child sk-bounce2 bg-gray-800"></div>
      <div class="sk-child sk-bounce3 bg-gray-800"></div>
    </div>
  </div><!-- d-flex -->
</div>

<%content_for :js do%>
    <script src="/js/jquery.sparkline.min.js"></script>
    <script>
      function search_data() {
          $('#loading').show();
          $('#data').hide();
          $.ajax({
              url:'<%=performance_report_admin_bills_path%>',
              method:'post',
              data:{
                  yyb: $('#search_yyb').val(),
                  cplx: $('#search_cplx').val(),
                  starttime: $('#search_starttime').val(),
                  endtime: $('#search_endtime').val()
              },
              success:function (data) {
                  $('#data-jybs').html(data.data.jybs);
                  $('#data-dkbs').html(data.data.jybs);
                  $('#data-dkrs').html(data.data.dkrs);
                  $('#data-dkye').html('¥'+fmoney(data.data.dkye,2));
                  $('#data-jyl').html('¥'+fmoney(data.data.jyl,2));

                  $('#data-pjjked').html((data.data.jybs==0 ? 0 : '¥'+  fmoney((data.data.jyl/data.data.jybs),2)));
                  $('#data-pjjkzq').html((data.data.jybs==0 ? 0 : fmoney((data.data.dkqx/data.data.jybs),1)));

                  $('#data-dybs').html(data.data.dy_jybs);
                  $('#data-dyje').html(data.data.dy_jyl);

                  $('#data-zybs').html(data.data.zy_jybs);
                  $('#data-zyje').html(data.data.zy_jyl);

                  $('#data-xzbs').html(data.data.xzbs);
                  $('#data-xzje').html(data.data.xzje);

                  $('#loading').hide();
                  $('#data').show();
              }
          })
      }


      $('.select2').select2({
          minimumResultsForSearch: Infinity
      });

      $('.fc-datepicker').datepicker({
          showOtherMonths: true,
          selectOtherMonths: true,
          dateFormat:'yy-mm-dd'
      });

      function fmoney(s, n) {
          n = n > 0 && n <= 20 ? n : 2;
          s = parseFloat((s + "").replace(/[^\d\.-]/g, "")).toFixed(n) + "";
          var l = s.split(".")[0].split("").reverse(), r = s.split(".")[1];
          t = "";
          for (i = 0; i < l.length; i++) {
              t += l[i] + ((i + 1) % 3 == 0 && (i + 1) != l.length ? "," : "");
          }
          return t.split("").reverse().join("") + "." + r;
      }

      $(function () {
          search_data()
      });

      $('.sparkline1').sparkline('html', {
          type: 'bar',
          barWidth: 5,
          height: 50,
          barColor: '#0083CD',
          chartRangeMin: 0,
          chartRangeMax: 10
      });

      $('.sparkline2').sparkline('html', {
          type: 'bar',
          barWidth: 5,
          height: 50,
          barColor: '#fff',
          lineColor: 'rgba(255,255,255,0.5)',
          chartRangeMin: 0,
          chartRangeMax: 10
      });
    </script>
<%end%>